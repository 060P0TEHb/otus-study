# Home work 9 (ansible)

В данный vagrant файл добавлены след. опции:

- Загружается бокс "Centos 7" версии 1902.01
- Виртуальной машине выделяется 512M RAM и 1 cpu
- Настраивается внешний ip - 192.168.10.50
- Копируется публичный ключ в пользователя vagrant

Далее из корневой папки проекта (Lesson9) нужно выполнить ansible-playbook playbooks/common.yml. Выполниться playbook, который установит и настроит nginx. В итоге получим 2 vhost-а: один имеет имя nginx.local и слушает порт 80, другой test.local и порт 8080.
Что бы получить доступ к сайтам, нужно прописать в /etc/hosts след.:
```
192.168.10.50 test.local
192.168.10.50 nginx.local
```
Playbook исп. роль otus_nginx. Во время выполнения playbook происходит след:
- устанавливается epel репозиторий
- устанавливается nginx 1.12.2-3.el7 версии
- копируется nginx.conf из template (значения беруться из playbook-а):
  - кол-во worker процессов берутся из кол-ва процессоров в системе (значение забирается из системных фактов)
  - далее идет проверка, объявлен ли хоть 1 vhost в playbook-е, если да, то запускается цикл по всем playbook-ам
  - подставляется порт. Если нету - то 80 по умолчанию
  - подставляется имя сервера
  - если сервер локальный - то подставляется путь до root-а проекта
  - конфигурируются access и error логи. Имя логов соответствует имени серверу
  - создается location /
  - если есть - создаются location для error_page 
- синхронизируются папки roles/otus_nginx/files и /var/www/ на вирт. машине
- выполняются handlers:
  - Стартует nginx и прописывается в автозагрузку
  - Если изменены конфигруции, nginx перечитывает файлы конфигурации
  - Для папки /var/www/ добавляется type=httpd_sys_content_t для SELinux
